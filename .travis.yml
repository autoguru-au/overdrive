language: node_js
cache: yarn
notifications:
  email: false
env:
  - TZ=Australia/Brisbane

jobs:
  include:
    - stage: test
      script: yarn test
      after_success:
        - curl -s https://codecov.io/bash | bash
        - yarn run chromatic
    - stage: deploy
      script: yarn build
      after_success: |
        if [ -n "$TRAVIS_PULL_REQUEST_SHA" ]; then
          npx surge -p ./storybook-static/ -d overdrive--${TRAVIS_PULL_REQUEST_SHA}.surge.sh
        elif [ "$TRAVIS_BRANCH" == "master" ]; then
          npx surge -p ./storybook-static/ -d overdrive.autoguru.io
        fi
