import{r as c}from"./iframe-C5x-mm7q.js";import{n as O,l as I,y as T,z as D,v as U}from"./useFocusable-DEn2IQoa.js";import{$ as j}from"./useLabel-Dq7X9E2k.js";const S={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},B={...S,customError:!0,valid:!1},m={isInvalid:!1,validationDetails:S,validationErrors:[]},F=c.createContext({}),L="__formValidationState"+Date.now();function W(i){if(i[L]){let{realtimeValidation:e,displayValidation:a,updateValidation:r,resetValidation:v,commitValidation:l}=i[L];return{realtimeValidation:e,displayValidation:a,updateValidation:r,resetValidation:v,commitValidation:l}}return Q(i)}function Q(i){let{isInvalid:e,validationState:a,name:r,value:v,builtinValidation:l,validate:o,validationBehavior:n="aria"}=i;a&&(e||(e=a==="invalid"));let u=e!==void 0?{isInvalid:e,validationErrors:[],validationDetails:B}:null,d=c.useMemo(()=>{if(!o||v==null)return null;let s=k(o,v);return P(s)},[o,v]);l?.validationDetails.valid&&(l=void 0);let t=c.useContext(F),f=c.useMemo(()=>r?Array.isArray(r)?r.flatMap(s=>h(t[s])):h(t[r]):[],[t,r]),[$,C]=c.useState(t),[x,p]=c.useState(!1);t!==$&&(C(t),p(!1));let V=c.useMemo(()=>P(x?[]:f),[x,f]),w=c.useRef(m),[E,g]=c.useState(m),b=c.useRef(m),A=()=>{if(!R)return;y(!1);let s=d||l||w.current;M(s,b.current)||(b.current=s,g(s))},[R,y]=c.useState(!1);return c.useEffect(A),{realtimeValidation:u||V||d||l||m,displayValidation:n==="native"?u||V||E:u||V||d||l||E,updateValidation(s){n==="aria"&&!M(E,s)?g(s):w.current=s},resetValidation(){let s=m;M(s,b.current)||(b.current=s,g(s)),n==="native"&&y(!1),p(!0)},commitValidation(){n==="native"&&y(!0),p(!0)}}}function h(i){return i?Array.isArray(i)?i:[i]:[]}function k(i,e){if(typeof i=="function"){let a=i(e);if(a&&typeof a!="boolean")return h(a)}return[]}function P(i){return i.length?{isInvalid:!0,validationErrors:i,validationDetails:B}:null}function M(i,e){return i===e?!0:!!i&&!!e&&i.isInvalid===e.isInvalid&&i.validationErrors.length===e.validationErrors.length&&i.validationErrors.every((a,r)=>a===e.validationErrors[r])&&Object.entries(i.validationDetails).every(([a,r])=>e.validationDetails[a]===r)}function X(...i){let e=new Set,a=!1,r={...S};for(let o of i){var v,l;for(let n of o.validationErrors)e.add(n);a||(a=o.isInvalid);for(let n in r)(v=r)[l=n]||(v[l]=o.validationDetails[n])}return r.valid=!a,{isInvalid:a,validationErrors:[...e],validationDetails:r}}function Z(i,e,a){let{validationBehavior:r,focus:v}=i;O(()=>{if(r==="native"&&a?.current&&!a.current.disabled){let d=e.realtimeValidation.isInvalid?e.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";a.current.setCustomValidity(d),a.current.hasAttribute("title")||(a.current.title=""),e.realtimeValidation.isInvalid||e.updateValidation(z(a.current))}});let l=c.useRef(!1),o=I(()=>{l.current||e.resetValidation()}),n=I(d=>{var t;e.displayValidation.isInvalid||e.commitValidation();let f=a==null||(t=a.current)===null||t===void 0?void 0:t.form;if(!d.defaultPrevented&&a&&f&&N(f)===a.current){var $;v?v():($=a.current)===null||$===void 0||$.focus(),T("keyboard")}d.preventDefault()}),u=I(()=>{e.commitValidation()});c.useEffect(()=>{let d=a?.current;if(!d)return;let t=d.form,f=t?.reset;return t&&(t.reset=()=>{l.current=!window.event||window.event.type==="message"&&window.event.target instanceof MessagePort,f?.call(t),l.current=!1}),d.addEventListener("invalid",n),d.addEventListener("change",u),t?.addEventListener("reset",o),()=>{d.removeEventListener("invalid",n),d.removeEventListener("change",u),t?.removeEventListener("reset",o),t&&(t.reset=f)}},[a,n,u,o,r])}function q(i){let e=i.validity;return{badInput:e.badInput,customError:e.customError,patternMismatch:e.patternMismatch,rangeOverflow:e.rangeOverflow,rangeUnderflow:e.rangeUnderflow,stepMismatch:e.stepMismatch,tooLong:e.tooLong,tooShort:e.tooShort,typeMismatch:e.typeMismatch,valueMissing:e.valueMissing,valid:e.valid}}function z(i){return{isInvalid:!i.validity.valid,validationDetails:q(i),validationErrors:i.validationMessage?[i.validationMessage]:[]}}function N(i){for(let e=0;e<i.elements.length;e++){let a=i.elements[e];if(!a.validity.valid)return a}return null}function _(i){let{description:e,errorMessage:a,isInvalid:r,validationState:v}=i,{labelProps:l,fieldProps:o}=j(i),n=D([!!e,!!a,r,v]),u=D([!!e,!!a,r,v]);return o=U(o,{"aria-describedby":[n,u,i["aria-describedby"]].filter(Boolean).join(" ")||void 0}),{labelProps:l,fieldProps:o,descriptionProps:{id:n},errorMessageProps:{id:u}}}export{W as $,Z as a,L as b,_ as c,m as d,X as e};
